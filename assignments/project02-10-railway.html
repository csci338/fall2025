<!doctype html>
<html lang="en">
    <head>
            <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/fall2025/assets/images/favicon.ico" type="image/x-icon">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <title>Cloud Deployment</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link rel="stylesheet" href="/fall2025/assets/main.css">
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-163192686-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-163192686-1');
    </script>
    </head>
    <body class="two-column">
        <!-- banner -->
<header>
    <section>
        <h1 class="desktop"><a href="/fall2025/">CSCI 338: Fall 2025</a></h1>
        <h2 class="desktop">Software Engineering</h2>
        <a class="mobile" href="#">
            <i class="menu-toggle fas fa-bars"></i>
        </a>
        <h1 class="mobile">CSCI 338: Fall 2025</h1>
    </section>
    <img src="https://communication.unca.edu/wp-content/themes/tin/assets/logo.svg" />
</header>
        <nav>
    <ul>
        <li ><a href="/fall2025/syllabus/">Syllabus</a>
        </li>
        <li ><a
                href="/fall2025/">Schedule</a></li>
        <li class="active" ><a
                href="/fall2025/assignments/">Assignments</a></li>
        <li ><a
                href="/fall2025/resources/">Resources</a></li>
        <li ><a href="/fall2025/repos/">Repos</a>
        </li>
        <li><a href="https://drive.google.com/drive/folders/1iI-Iz85UpjGyuu9q_reuq4vT6hC4AEQq?usp=drive_link"
                target="_blank">Videos</a></li>
    </ul>
</nav>
        <main>
            <aside>
                
                
                <ol class="side-menu">
  <li><a href="#id_production-dockerfile">Production Dockerfile</a>
    <ol>
      <li><a href="#id_-before-you-move-on"> Before you move on</a></li>
    </ol>
  </li>
  <li><a href="#id_create-railway-account-and-project">Create Railway Account and Project</a>
    <ol>
      <li><a href="#id_-before-you-move-on-1"> Before you move on</a></li>
    </ol>
  </li>
  <li><a href="#id_create-postgresql-database">Create PostgreSQL Database</a>
    <ol>
      <li><a href="#id_-before-you-move-on-2"> Before you move on</a></li>
    </ol>
  </li>
  <li><a href="#id_deploy-your-application">Deploy Your Application</a>
    <ol>
      <li><a href="#id_-before-you-move-on-3"> Before you move on</a></li>
    </ol>
  </li>
  <li><a href="#id_update-frontend-api-url-if-needed">Update Frontend API URL (If Needed)</a>
    <ol>
      <li><a href="#id_-before-you-move-on-4"> Before you move on</a></li>
    </ol>
  </li>
  <li><a href="#id_verify-deployment">Verify Deployment</a>
    <ol>
      <li><a href="#id_-before-you-move-on-5"> Before you move on</a></li>
    </ol>
  </li>
</ol>

            </aside>
            <article>
                


    <h1>
        <a href="../assignments/project02">Project 2</a> >
        Cloud Deployment
    </h1>
    
 
                <p>
    
    
    
</p>

<h2 id="id_production-dockerfile">Production Dockerfile</h2>

<p>Create <code class="language-plaintext highlighter-rouge">Dockerfile.prod</code> in the root directory:</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Combined Production Dockerfile for Railway</span>
<span class="c"># Builds both frontend and backend, serves them together</span>

<span class="c"># Stage 1: Build Frontend</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">node:20-slim</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s">frontend-builder</span>

<span class="k">WORKDIR</span><span class="s"> /app/frontend</span>

<span class="c"># Copy frontend package files</span>
<span class="k">COPY</span><span class="s"> ui/package.json ./</span>

<span class="c"># Install dependencies</span>
<span class="k">RUN </span>npm <span class="nb">install</span> <span class="nt">--production</span><span class="o">=</span><span class="nb">false</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span>    npm <span class="nb">install</span> @rollup/rollup-linux-x64-gnu <span class="nt">--save-optional</span> <span class="o">||</span> <span class="nb">true</span>

<span class="c"># Copy frontend source code</span>
<span class="k">COPY</span><span class="s"> ui/ ./</span>

<span class="c"># Build the React app</span>
<span class="k">RUN </span>npm run build

<span class="c"># Stage 2: Build Backend Dependencies</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.11-slim</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s">backend-builder</span>

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="c"># Install Poetry</span>
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">--no-cache-dir</span> poetry

<span class="c"># Configure Poetry</span>
<span class="k">RUN </span>poetry config virtualenvs.create <span class="nb">false</span>

<span class="c"># Copy backend dependency files</span>
<span class="k">COPY</span><span class="s"> backend/pyproject.toml backend/poetry.lock* ./</span>

<span class="c"># Install dependencies (production only)</span>
<span class="k">RUN </span>poetry <span class="nb">install</span> <span class="nt">--no-interaction</span> <span class="nt">--no-ansi</span> <span class="nt">--only</span><span class="o">=</span>main <span class="nt">--no-root</span>

<span class="c"># Stage 3: Final Runtime Image</span>
<span class="k">FROM</span><span class="s"> python:3.11-slim</span>

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="c"># Copy installed Python packages and binaries from builder</span>
<span class="k">COPY</span><span class="s"> --from=backend-builder /usr/local/lib/python3.11/site-packages /usr/local/lib/python3.11/site-packages</span>
<span class="k">COPY</span><span class="s"> --from=backend-builder /usr/local/bin /usr/local/bin</span>

<span class="c"># Copy backend application code</span>
<span class="k">COPY</span><span class="s"> backend/ ./backend/</span>

<span class="c"># Copy built frontend from frontend-builder to /app/static</span>
<span class="k">COPY</span><span class="s"> --from=frontend-builder /app/frontend/dist ./static</span>

<span class="c"># Create non-root user for security</span>
<span class="k">RUN </span>useradd <span class="nt">-m</span> <span class="nt">-u</span> 1000 appuser <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">chown</span> <span class="nt">-R</span> appuser:appuser /app

<span class="k">USER</span><span class="s"> appuser</span>

<span class="c"># Expose port (Railway sets PORT automatically)</span>
<span class="k">EXPOSE</span><span class="s"> 8000</span>

<span class="c"># Use PORT environment variable if set, otherwise default to 8000</span>
<span class="k">ENV</span><span class="s"> PORT=8000</span>

<span class="c"># Change to backend directory and run server</span>
<span class="k">WORKDIR</span><span class="s"> /app/backend</span>
<span class="k">CMD</span><span class="s"> sh -c "uvicorn server:app --host 0.0.0.0 --port \${PORT:-8000}"</span>
</code></pre></div></div>

<p><strong>Important Notes:</strong></p>
<ul>
  <li>This is a multi-stage build that combines frontend and backend</li>
  <li>The frontend is built and served as static files by the backend</li>
  <li>Make sure your <code class="language-plaintext highlighter-rouge">server.py</code> has code to serve static files in production</li>
</ul>

<blockquote class="info">
  <h3 id="id_-before-you-move-on"><i class="fa-regular fa-circle-check"></i> Before you move on</h3>
  <p>Verify your production Dockerfile is in the root directory.</p>
</blockquote>

<h2 id="id_create-railway-account-and-project">Create Railway Account and Project</h2>

<ol>
  <li><strong>Sign up for Railway:</strong>
    <ul>
      <li>Go to https://railway.app</li>
      <li>Sign up with your GitHub account (recommended) or email</li>
      <li>Railway offers a free tier with $5/month credit</li>
    </ul>
  </li>
  <li><strong>Create a new project:</strong>
    <ul>
      <li>Click “New Project” in the Railway dashboard</li>
      <li>Select “Deploy from GitHub repo”</li>
      <li>Choose your <code class="language-plaintext highlighter-rouge">project02-fall2025</code> repository</li>
      <li>Railway will create a new project for you</li>
    </ul>
  </li>
</ol>

<blockquote class="info">
  <h3 id="id_-before-you-move-on-1"><i class="fa-regular fa-circle-check"></i> Before you move on</h3>
  <p>Verify you have a Railway account and project connected to your GitHub repository.</p>
</blockquote>

<h2 id="id_create-postgresql-database">Create PostgreSQL Database</h2>

<ol>
  <li><strong>Add a PostgreSQL service:</strong>
    <ul>
      <li>In your Railway project dashboard, click “+ New”</li>
      <li>Select “Database” → “Add PostgreSQL”</li>
      <li>Railway will automatically create a PostgreSQL database</li>
    </ul>
  </li>
  <li><strong>Get the database connection string:</strong>
    <ul>
      <li>Click on the PostgreSQL service you just created</li>
      <li>Go to the “Variables” tab</li>
      <li>Find the <code class="language-plaintext highlighter-rouge">DATABASE_URL</code> variable (Railway creates this automatically)</li>
      <li>Copy the connection string - it will look like:
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>postgresql://postgres:password@hostname.railway.app:5432/railway
</code></pre></div>        </div>
      </li>
      <li><strong>Important:</strong> Note that Railway uses <code class="language-plaintext highlighter-rouge">postgresql://</code> (not <code class="language-plaintext highlighter-rouge">postgresql+asyncpg://</code>). You’ll need to modify this for SQLAlchemy.</li>
    </ul>
  </li>
  <li><strong>Convert the connection string for SQLAlchemy:</strong>
    <ul>
      <li>Railway’s <code class="language-plaintext highlighter-rouge">DATABASE_URL</code> uses the format: <code class="language-plaintext highlighter-rouge">postgresql://...</code></li>
      <li>SQLAlchemy with asyncpg needs: <code class="language-plaintext highlighter-rouge">postgresql+asyncpg://...</code></li>
      <li>Replace <code class="language-plaintext highlighter-rouge">postgresql://</code> with <code class="language-plaintext highlighter-rouge">postgresql+asyncpg://</code> in your connection string</li>
      <li>Example:
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Original: postgresql://postgres:password@hostname.railway.app:5432/railway
Modified: postgresql+asyncpg://postgres:password@hostname.railway.app:5432/railway
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ol>

<blockquote class="info">
  <h3 id="id_-before-you-move-on-2"><i class="fa-regular fa-circle-check"></i> Before you move on</h3>
  <p>Verify you have:</p>
  <ul>
    <li>A PostgreSQL database created in Railway</li>
    <li>The <code class="language-plaintext highlighter-rouge">DATABASE_URL</code> connection string copied</li>
    <li>The connection string modified to use <code class="language-plaintext highlighter-rouge">postgresql+asyncpg://</code></li>
  </ul>
</blockquote>

<h2 id="id_deploy-your-application">Deploy Your Application</h2>

<ol>
  <li><strong>Add your application service:</strong>
    <ul>
      <li>In your Railway project dashboard, click “+ New”</li>
      <li>Select “GitHub Repo” → choose your repository</li>
      <li>Railway will detect your <code class="language-plaintext highlighter-rouge">Dockerfile.prod</code> automatically</li>
    </ul>
  </li>
  <li><strong>Configure the service:</strong>
    <ul>
      <li>Railway should automatically detect <code class="language-plaintext highlighter-rouge">Dockerfile.prod</code> in the root directory</li>
      <li>If not, go to Settings → General → Root Directory (leave blank if Dockerfile is in root)</li>
      <li>Go to Settings → Deploy → Dockerfile Path: <code class="language-plaintext highlighter-rouge">Dockerfile.prod</code></li>
    </ul>
  </li>
  <li><strong>Set environment variables:</strong>
    <ul>
      <li>Go to the “Variables” tab in your application service</li>
      <li>Add the <code class="language-plaintext highlighter-rouge">DATABASE_URL</code> variable:
        <ul>
          <li>Click “+ New Variable”</li>
          <li>Name: <code class="language-plaintext highlighter-rouge">DATABASE_URL</code></li>
          <li>Value: Your modified connection string (with <code class="language-plaintext highlighter-rouge">postgresql+asyncpg://</code>)</li>
          <li>Click “Add”</li>
        </ul>
      </li>
      <li><strong>Important:</strong> Use the modified connection string (with <code class="language-plaintext highlighter-rouge">+asyncpg</code>) here</li>
    </ul>
  </li>
  <li><strong>Link the database:</strong>
    <ul>
      <li>Railway can automatically link services</li>
      <li>In your application service, go to the “Variables” tab</li>
      <li>You should see a “Reference Variable” option</li>
      <li>Reference the PostgreSQL service’s <code class="language-plaintext highlighter-rouge">DATABASE_URL</code></li>
      <li><strong>But remember:</strong> You still need to modify it to use <code class="language-plaintext highlighter-rouge">postgresql+asyncpg://</code></li>
    </ul>
  </li>
  <li><strong>Deploy:</strong>
    <ul>
      <li>Railway will automatically deploy when you push to your main branch</li>
      <li>Or click “Deploy” in the dashboard to trigger a manual deployment</li>
      <li>Watch the build logs to see the deployment progress</li>
    </ul>
  </li>
  <li><strong>Get your application URL:</strong>
    <ul>
      <li>Once deployed, Railway will provide a public URL</li>
      <li>Go to Settings → Networking → Generate Domain</li>
      <li>Your app will be available at: <code class="language-plaintext highlighter-rouge">https://your-app-name.up.railway.app</code></li>
    </ul>
  </li>
</ol>

<blockquote class="info">
  <h3 id="id_-before-you-move-on-3"><i class="fa-regular fa-circle-check"></i> Before you move on</h3>
  <p>Verify your application is:</p>
  <ul>
    <li>Deployed on Railway</li>
    <li>Connected to the PostgreSQL database</li>
    <li>Accessible via a public URL</li>
    <li>Test it by visiting your Railway URL</li>
  </ul>
</blockquote>

<h2 id="id_update-frontend-api-url-if-needed">Update Frontend API URL (If Needed)</h2>

<p>If your frontend needs to connect to the deployed backend:</p>

<ol>
  <li><strong>Set the API URL:</strong>
    <ul>
      <li>In your Railway application service, go to Variables</li>
      <li>Add: <code class="language-plaintext highlighter-rouge">VITE_API_URL</code> = <code class="language-plaintext highlighter-rouge">https://your-app-name.up.railway.app</code></li>
      <li>Or update your frontend code to use the Railway URL instead of <code class="language-plaintext highlighter-rouge">localhost:8000</code></li>
    </ul>
  </li>
  <li><strong>Rebuild and redeploy:</strong>
    <ul>
      <li>Railway will automatically rebuild when you push changes</li>
      <li>Or trigger a manual redeploy from the dashboard</li>
    </ul>
  </li>
</ol>

<blockquote class="info">
  <h3 id="id_-before-you-move-on-4"><i class="fa-regular fa-circle-check"></i> Before you move on</h3>
  <p>Verify your full-stack application is:</p>
  <ul>
    <li>Fully deployed and accessible online</li>
    <li>Frontend connecting to the deployed backend</li>
    <li>Database operations working correctly</li>
  </ul>
</blockquote>

<h2 id="id_verify-deployment">Verify Deployment</h2>

<p>Test your deployed application:</p>

<ol>
  <li><strong>Visit your Railway URL:</strong>
    <ul>
      <li>Open <code class="language-plaintext highlighter-rouge">https://your-app-name.up.railway.app</code> in your browser</li>
      <li>Your application should load</li>
    </ul>
  </li>
  <li><strong>Test API endpoints:</strong>
    <ul>
      <li>Visit <code class="language-plaintext highlighter-rouge">https://your-app-name.up.railway.app/docs</code> to see the FastAPI documentation</li>
      <li>Test the <code class="language-plaintext highlighter-rouge">/todos</code> endpoint to verify database connectivity</li>
    </ul>
  </li>
  <li><strong>Test CRUD operations:</strong>
    <ul>
      <li>Create a new todo</li>
      <li>Read todos</li>
      <li>Update a todo</li>
      <li>Delete a todo</li>
      <li>Verify all operations work correctly</li>
    </ul>
  </li>
</ol>

<blockquote class="info">
  <h3 id="id_-before-you-move-on-5"><i class="fa-regular fa-circle-check"></i> Before you move on</h3>
  <p>Verify your deployed application:</p>
  <ul>
    <li>Loads correctly in the browser</li>
    <li>Has working API endpoints</li>
    <li>Successfully performs all CRUD operations</li>
    <li>Is accessible from any device with internet access</li>
  </ul>
</blockquote>

<hr />

<p><a href="project02">← Back to Project 2 Instructions</a></p>



            </article>  
        </main>
        <footer>
            <p>    
                Department of Computer Science, UNC Asheville
            </p>
        </footer>
        
        <script type="text/javascript" src="/fall2025/assets/js/main.js"></script>
<script type="text/javascript" src="/fall2025/assets/js/copy-code.js"></script>

<!-- <script>
    //little bit of a hack:
    const scrollLeft = () => {
        //console.log('scrollLeft');
        document.documentElement.scrollLeft = 0;
    };
    setTimeout(scrollLeft, 100);
</script> -->
        
        <script type="text/javascript" src="/fall2025/assets/js/scrollspy.js"></script>
        <script type="text/javascript" src="/fall2025/assets/js/expandable.js"></script>
    </body>
</html>